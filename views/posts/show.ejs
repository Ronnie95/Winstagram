<%- include('../partials/header.ejs') %>

<div class="post-header">
  <p>Posted by: <%= post.user.username %></p>
  <p>Location: <%= post.location %></p>
</div>

<div class="post-image">
  <img src="<%= post.image %>" alt="Post image" width="300">
</div>

<div class="post-actions">
  <a href="/users/<%= userLoggedIn.id %>/posts/<%= post._id %>/edit">Edit</a>
  <form action="/users/<%= userLoggedIn.id %>/posts/<%= post._id %>?_method=DELETE" method="POST">
    <button type="submit">Delete</button>
  </form>
  <p>Likes: <%= post.likes.length %></p>
</div>

<h2 class="caption" style="background-color: #ffffff; border: 1px solid #000000; padding: 10px; margin: 10px 0;">Caption: <%= post.caption %></h2>


<div class="comments-section">
  <p>Comments: <%= post.comments.length %></p>

  <% post.comments.forEach(function(comment) { %>
    <div class="comment">
      <p><%= comment.text %></p>
      <p>Posted by: <%= comment.user.username %></p>
      <p>Posted on: <%= comment.createdAt.toDateString() %></p>

      <% if (userLoggedIn && comment.user._id.toString() === userLoggedIn.id.toString()) { %>
        <a href="/users/<%= userLoggedIn.id %>/posts/<%= post._id %>/comments/<%= comment._id %>/edit" class="edit-button">Edit</a>
        <form action="/users/<%= userLoggedIn.id %>/posts/<%= post._id %>/comments/<%= comment._id %>?_method=DELETE" method="POST">
          <button type="submit" class="delete-button">Delete</button>
        </form>
      <% } %>
    </div>
  <% }); %>

  <% if (userLoggedIn) { %>
    <div class="comment-form">
      <h3>Add a comment:</h3>
      <form action="/users/<%= userLoggedIn.id %>/posts/<%= post._id %>/comments" method="POST">
        <input type="hidden" name="userId" value="<%= userLoggedIn.id %>">
        <input type="hidden" name="postId" value="<%= post._id %>">
        <textarea name="text" rows="3" cols="50" placeholder="Add your comment..." required></textarea><br>
        <input type="submit" value="Post Comment">
      </form>
    </div>
  <% } %>
</div>

<%- include('../partials/footer.ejs') %>

